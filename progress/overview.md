# PGLumiLineage 项目进度与设计决策追溯系统

**最后更新时间**：2025-05-16

## 项目当前状态

PGLumiLineage 是一个基于 PostgreSQL 的自动化数据血缘分析与知识图谱构建平台，目前处于活跃开发阶段。该项目利用大语言模型（LLM）和图数据库（Apache AGE）技术，从 PostgreSQL 的运行时日志及元数据中自动提取、分析并可视化数据血缘关系。

### 当前已实现的核心功能

- 自动化日志采集与处理
- 全面元数据收集
- SQL 范式化与模式聚合
- LLM 驱动的关系提取
- 知识图谱构建
- 灵活配置与调度系统
- 血缘关系可视化API接口

### 正在进行的工作

- LLM 分析器提示词优化，提高数据血缘分析的准确性
- 临时表处理逻辑完善
- 进度日志与设计决策追溯系统建立

## 主要模块索引

以下是项目的主要模块，点击链接可查看每个模块的详细进度与设计决策：

- [数据源配置 (lumi_config)](./lumi_config_decisions.md)
- [日志处理器 (log_processor)](./log_processor_decisions.md)
- [元数据收集器 (metadata_collector)](./metadata_collector_decisions.md)
- [SQL范式化与聚合器 (sql_normalizer)](./sql_normalizer_decisions.md)
- [LLM分析器 (llm_analyzer)](./llm_analyzer_decisions.md)
- [AGE图谱构建器 (age_graph_builder)](./age_builder_decisions.md)
- [血缘关系 API (api)](./api_decisions.md)
- [调度与编排服务 (scheduler)](./scheduler_decisions.md)
- [通用模块与配置 (common)](./common_decisions.md)
- [数据库设计 (iwdb_schemas)](./database_design_decisions.md)

## 全局设计原则与重要决策

### 技术栈选择

1. **Python 与 asyncio**：
   - 选择 Python 3.10+ 作为主要开发语言，利用其丰富的数据处理库和简洁的语法
   - 采用 asyncio 进行异步处理，提高系统处理大量 I/O 操作的效率
   - 使用 asyncpg 作为 PostgreSQL 异步客户端，实现高性能数据库交互

2. **PostgreSQL 与 Apache AGE**：
   - 选择 PostgreSQL 15+ 作为中央存储系统，利用其稳定性和强大的扩展生态
   - 采用 Apache AGE 作为图数据库扩展，实现与 PostgreSQL 的无缝集成
   - 未来计划支持基于 PG 内核的 MPP 数据库 Cloudberry，以满足大规模生产环境需求

3. **LLM 技术选型**：
   - 初期集成阿里云通义千问（Qwen）系列，通过 OpenAI 兼容 API 调用
   - 选择 Qwen 的原因是其在中文语境下的优秀表现和对结构化数据处理的能力
   - 设计了可扩展的接口，便于未来集成其他 LLM 模型

### 架构设计原则

1. **模块化设计**：
   - 系统被划分为多个功能明确的独立模块，每个模块负责特定的功能
   - 模块间通过数据库进行松耦合交互，降低直接依赖
   - 便于独立部署、扩展和维护

2. **数据驱动架构**：
   - 以数据流为核心设计系统架构
   - 各模块围绕数据的采集、处理、分析和可视化进行组织
   - 采用 ETL（提取、转换、加载）思想处理数据流

3. **可扩展性设计**：
   - 预留接口支持多种数据源类型
   - 设计灵活的调度系统，支持不同模块的独立调度
   - 采用配置驱动的方式管理系统行为，减少硬编码

### 跨模块重要决策

1. **数据存储策略**：
   - 使用专用的内部数据库（iwdb）存储系统配置、处理后的日志、元数据和分析结果
   - 采用模式化的数据库设计，不同类型的数据存储在不同的模式中
   - 原始数据、处理后数据和配置数据分离存储，便于管理和维护

2. **错误处理与恢复机制**：
   - 实现细粒度的错误捕获和日志记录
   - 设计任务重试机制，提高系统稳定性
   - 关键操作采用事务处理，确保数据一致性

3. **安全性考虑**：
   - 敏感配置信息（如数据库密码、API 密钥）采用加密存储
   - 实现访问控制，限制对敏感数据的访问
   - 日志和分析结果中剔除敏感信息

## 项目演进路线图

### 短期目标（1-3个月）

- 完善 LLM 分析器，提高数据血缘分析的准确性和覆盖率
- 增强对复杂 SQL 结构（如 UNION、子查询、CTE）的处理能力
- 改进临时表和未知表的处理逻辑
- 完善进度日志与设计决策追溯系统

### 中期目标（3-6个月）

- 支持更多数据源类型（如 MySQL、Oracle、Snowflake 等）
- 完善数据血缘可视化界面，整合前端图形库
- 实现更精细的数据血缘分析，包括业务规则提取
- 集成更多 LLM 模型，提供模型选择能力

### 长期目标（6个月以上）

- 构建完整的数据知识图谱，包括数据血缘、数据质量、数据使用情况等
- 实现与 LLM 的深度融合，提供智能数据分析和决策支持
- 建立企业级数据资产管理平台，支持数据治理和数据价值挖掘
