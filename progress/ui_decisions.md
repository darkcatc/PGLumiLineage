# 血缘关系可视化UI设计决策

**最后更新时间**：2025-05-21

## 概述

血缘关系可视化UI模块负责将从Apache AGE图数据库中查询的血缘关系数据以直观、交互式的方式呈现给用户。该模块采用AntV G6作为核心图可视化库，结合现代前端框架构建响应式、用户友好的界面，支持数据血缘图的展示、交互和分析。

## 核心设计决策

### 1. 技术栈选择

| 决策日期 | 决策内容 | 主要理由 | 讨论的关键点 |
|---------|---------|---------|------------|
| 2025-05-18 | 选择AntV G6作为图可视化库 | 功能丰富、性能优秀、中文社区支持 | 考虑了D3.js、Cytoscape.js、Vis.js等，最终选择G6因其在大规模图渲染和交互方面的优势 |
| 2025-05-18 | 前端框架选择Vue 3 | 轻量级、响应式、组件化 | 讨论了React、Angular、Vue的优缺点，选择Vue 3因其易于集成和学习曲线较平缓 |
| 2025-05-18 | 使用TypeScript进行开发 | 类型安全、代码可维护性高 | 确保前端代码的健壮性，减少运行时错误 |
| 2025-05-18 | 采用Vite作为构建工具 | 快速的热重载、优化的构建 | 相比Webpack，Vite提供更快的开发体验和构建速度 |

### 2. UI/UX设计原则

| 决策日期 | 决策内容 | 主要理由 | 讨论的关键点 |
|---------|---------|---------|------------|
| 2025-05-18 | 采用响应式设计 | 适配不同设备和屏幕尺寸 | 讨论了移动端和桌面端的使用场景差异 |
| 2025-05-18 | 暗色主题为默认，支持主题切换 | 减轻长时间使用的视觉疲劳 | 考虑了数据分析工具的长时间使用特性 |
| 2025-05-18 | 分区布局（图区、信息面板、工具栏） | 清晰的功能区分，提高使用效率 | 分析了用户工作流程和常用操作 |
| 2025-05-18 | 渐进式信息展示 | 先概览后细节，避免信息过载 | 讨论了复杂图数据的认知负担问题 |

### 3. 图可视化设计

| 决策日期 | 决策内容 | 主要理由 | 讨论的关键点 |
|---------|---------|---------|------------|
| 2025-05-18 | 节点分类可视化策略 | 通过形状、颜色、图标区分不同类型节点 | 确保节点类型的直观识别 |
| 2025-05-18 | 边分类可视化策略 | 通过颜色、线型、箭头样式区分不同类型关系 | 确保关系类型的直观识别 |
| 2025-05-18 | 多种布局算法支持 | 适应不同类型的图结构 | 分析了不同血缘关系图的特点和适用布局 |
| 2025-05-18 | 节点分组与折叠机制 | 处理大规模图的复杂性 | 讨论了如何平衡信息完整性和视觉清晰度 |

### 4. 交互设计

| 决策日期 | 决策内容 | 主要理由 | 讨论的关键点 |
|---------|---------|---------|------------|
| 2025-05-18 | 多级缩放与平移 | 支持图的整体浏览和局部细节查看 | 考虑了大型血缘图的导航需求 |
| 2025-05-18 | 节点选择与高亮 | 突出显示用户关注的节点及其关联 | 讨论了多种高亮策略的视觉效果 |
| 2025-05-18 | 上下文菜单 | 提供节点和边的快捷操作 | 分析了常用操作和工作流程 |
| 2025-05-18 | 搜索与筛选 | 快速定位感兴趣的节点和关系 | 讨论了不同搜索策略的实现和效果 |

### 5. 后端集成与AGE 1.5.0适配

| 决策日期   | 决策内容                                     | 主要理由                                                                 | 讨论的关键点                                                                 |
|------------|----------------------------------------------|--------------------------------------------------------------------------|------------------------------------------------------------------------------|
| 2024-07-26 | 确保前端与已适配AGE 1.5.0的后端API顺畅集成 | 后端API为兼容AGE 1.5.0特性（如MERGE语句限制）进行了调整，前端需正确处理API的请求和响应格式，以保证数据展示的准确性。 | API响应数据结构一致性，错误处理机制，确保前端展示不受后端AGE版本限制带来的Cypher查询策略变化影响。 |

## 详细设计规范

### 1. 节点表示

| 节点类型 | 形状 | 颜色 | 图标 | 尺寸 | 备注 |
|---------|------|------|------|------|------|
| Database | 圆形 | #3498db (蓝色) | 数据库图标 | 大 (50px) | 作为层级最高的节点 |
| Schema | 六边形 | #2ecc71 (绿色) | 文件夹图标 | 中大 (40px) | 包含表和视图的容器 |
| Table | 矩形 | #e74c3c (红色) | 表格图标 | 中 (35px) | 标准数据表 |
| View | 矩形（圆角） | #9b59b6 (紫色) | 眼睛图标 | 中 (35px) | 视图对象 |
| Column | 椭圆形 | #f1c40f (黄色) | 列图标 | 小 (25px) | 表或视图中的列 |
| SqlPattern | 菱形 | #e67e22 (橙色) | 齿轮图标 | 中 (35px) | SQL操作节点 |
| TempTable | 虚线矩形 | #95a5a6 (灰色) | 临时表图标 | 中 (35px) | 临时表对象 |

### 2. 边表示

| 边类型 | 颜色 | 线型 | 箭头 | 粗细 | 备注 |
|---------|------|------|------|------|------|
| CONTAINS | #7f8c8d (灰色) | 实线 | 单箭头 | 1px | 表示包含关系 |
| REFERENCES | #3498db (蓝色) | 虚线 | 单箭头 | 1px | 表示引用关系 |
| DEPENDS_ON | #95a5a6 (灰色) | 点线 | 单箭头 | 1px | 表示依赖关系 |
| DATA_FLOW | #e74c3c (红色) | 实线 | 单箭头 | 2px | 表示数据流向 |
| GENERATES_FLOW | #e67e22 (橙色) | 实线 | 单箭头 | 2px | 表示生成流 |
| WRITES | #2ecc71 (绿色) | 实线 | 单箭头 | 2px | 表示写入关系 |
| READS | #9b59b6 (紫色) | 实线 | 单箭头 | 2px | 表示读取关系 |

### 3. 布局算法

1. **默认布局**: 分层布局 (Dagre) - 适合展示数据流向和层级关系
2. **可选布局**:
   - 力导向布局 (Force) - 适合展示节点间的关联强度
   - 环形布局 (Concentric) - 适合以某节点为中心的血缘关系
   - 辐射布局 (Radial) - 适合展示节点的层级和分支
   - 网格布局 (Grid) - 适合整齐排列节点

### 4. 交互功能详细规范

#### 基础交互

- **缩放**: 鼠标滚轮或触控板手势
- **平移**: 鼠标拖拽或触控板手势
- **节点选择**: 单击选中单个节点，Shift+单击多选
- **节点拖拽**: 鼠标拖拽调整节点位置
- **双击节点**: 展开/折叠子节点（如表的列）
- **悬停提示**: 显示节点/边的简要信息

#### 高级交互

- **上下文菜单**: 右键点击节点/边显示操作菜单
- **路径追踪**: 选中两个节点，高亮显示它们之间的所有路径
- **邻居高亮**: 选中节点时，高亮其直接相连的节点和边
- **筛选面板**: 根据节点类型、关系类型、时间范围等筛选显示内容
- **搜索功能**: 支持按名称、属性、标签等搜索节点
- **历史记录**: 支持浏览历史回退/前进
- **视图保存**: 保存当前视图状态，包括布局、选中节点等

### 5. 界面布局

```
+-------------------------------------------------------------+
|                          顶部工具栏                           |
| [搜索框] [布局选择] [缩放控制] [筛选] [导出] [设置]            |
+---------------+-------------------------------------------+--+
|               |                                           |  |
|               |                                           |  |
|               |                                           |  |
|               |                                           |  |
|   左侧面板     |              主图区域                      | 右 |
| (对象浏览器)   |        (血缘关系可视化)                    | 侧 |
|               |                                           | 面 |
|               |                                           | 板 |
|               |                                           |  |
|               |                                           | (详 |
|               |                                           | 情) |
|               |                                           |  |
+---------------+-------------------------------------------+--+
|                       底部状态栏/迷你地图                    |
+-------------------------------------------------------------+
```

## 实现计划

### 1. 前端项目结构

```
frontend/
├── public/
│   ├── icons/          # 节点和边的图标
│   └── favicon.ico
├── src/
│   ├── assets/         # 静态资源
│   ├── components/     # Vue组件
│   │   ├── common/     # 通用组件
│   │   ├── graph/      # 图相关组件
│   │   └── panels/     # 面板组件
│   ├── hooks/          # 自定义钩子
│   ├── services/       # API服务
│   ├── stores/         # 状态管理
│   ├── types/          # TypeScript类型定义
│   ├── utils/          # 工具函数
│   ├── views/          # 页面视图
│   ├── App.vue         # 根组件
│   ├── main.ts         # 入口文件
│   └── router.ts       # 路由配置
├── .eslintrc.js        # ESLint配置
├── .prettierrc.js      # Prettier配置
├── index.html          # HTML模板
├── package.json        # 项目依赖
├── tsconfig.json       # TypeScript配置
└── vite.config.ts      # Vite配置
```

### 2. 核心组件设计

1. **GraphContainer**: 图容器组件，负责图的初始化和生命周期管理
2. **GraphRenderer**: 图渲染组件，使用AntV G6渲染血缘图
3. **NodeRenderer**: 节点渲染组件，处理不同类型节点的样式和交互
4. **EdgeRenderer**: 边渲染组件，处理不同类型边的样式和交互
5. **ToolBar**: 工具栏组件，提供图操作工具
6. **SearchPanel**: 搜索面板组件，提供搜索和筛选功能
7. **InfoPanel**: 信息面板组件，显示选中节点/边的详细信息
8. **MiniMap**: 迷你地图组件，提供图的概览和导航

### 3. API集成计划

1. **GraphService**: 封装与后端API的交互
   - `fetchGraph(params)`: 获取血缘子图
   - `fetchObjectDetails(params)`: 获取对象详情
   - `findPaths(params)`: 查找两点间路径

2. **数据转换层**: 将API返回的数据转换为G6可用的格式
   - `transformNodes(apiNodes)`: 转换节点数据
   - `transformEdges(apiEdges)`: 转换边数据
   - `buildGraphData(apiResponse)`: 构建完整的图数据

### 4. 性能优化策略

1. **数据处理优化**:
   - 增量渲染大型图
   - 数据分页加载
   - 节点按需展开

2. **渲染优化**:
   - 使用WebGL渲染器处理大规模图
   - 视口外节点简化渲染
   - 边捆绑减少视觉复杂度

3. **交互优化**:
   - 节点拖拽节流
   - 缩放平滑过渡
   - 高亮计算优化

## 未来计划

1. **功能扩展**:
   - 添加更多分析工具（如中心度分析、社区发现）
   - 支持用户自定义样式和布局
   - 集成数据质量和血缘时间线可视化

2. **性能提升**:
   - 实现WebWorker处理大规模图计算
   - 优化大型图的内存使用
   - 实现图数据的客户端缓存

3. **用户体验改进**:
   - 添加引导式教程
   - 实现更多键盘快捷键
   - 支持图注释和协作标记

4. **集成扩展**:
   - 与BI工具集成
   - 支持图导出为多种格式
   - 实现血缘图的版本比较
